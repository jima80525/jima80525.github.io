
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="author" content="Jim Anderson" />
        <meta name="description" content="While working on a different project, I recently discovered the &#39;script&#39; command in Linux. It captures all of the input and output from a shell session. This can be really handy if you want to write a blog post that involves a lot of commands. I did find that there â€¦" />


    <title>Using the Linux 'script' command - Snowboarding Coder</title>

        <link rel="stylesheet" href="/theme/css/bootstrap.darkly.min.css" type="text/css"/>

    <link href="/theme/css/fontawesome-all.min.css" rel="stylesheet" />
    <link href="/theme/css/pygments/xcode.css" rel="stylesheet" />

    <link href="/theme/css/pelican-twitchy.min.css" rel="stylesheet" />

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <!-- Feeds -->
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Snowboarding Coder ATOM Feed" />
</head>
<body data-spy="scroll" data-target="#scrollspy">
    <div id="wrapper">
        <!-- Sidebar -->
        <div id="sidebar-wrapper-small" class="twitchy-background">
            <ul id="accordion-small" class="sidebar-nav sidebar-nav-small">
                <li>
        <a href="" title="Snowboarding Coder" class="collapsed">
            <span class="fas fa-home"></span>
        </a>
    </li>
                <li class="nav-divider"></li>
                <li>
        <a href="/archives.html" title="Recent Articles" class="collapsed">
            <span class="fas fa-th-list"></span>
        </a>
    </li>
                <li class="nav-divider"></li>
                <li id="share-small">
                    <a data-toggle="collapse" data-parent="#accordion-small" href="#collapse-share-small" title="Share" class="collapsed">
                        <i class="fas fa-share-alt padding-small"></i>
                    </a>
                </li>
                <li class="panel anti-panel"><ul id="collapse-share-small" class="collapse ">
                    <li>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=/using-the-linux-script-command.html" title="Share via Facebook" target="popup">
                            <i class="fas fa-facebook-square padding-small"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://plus.google.com/share?url=/using-the-linux-script-command.html" title="Share via Google+" target="popup">
                            <i class="fas fa-google-plus padding-small"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://twitter.com/share" class="twitter-share-button" data-count="vertical" title="Share via Twitter" target="popup">
                            <i class="fas fa-twitter-square padding-small"></i>
                        </a>
                    </li>
                </ul></li>
                <li class="nav-divider"></li>
                <li>
                    <a data-toggle="collapse" data-parent="#accordion-small" href="#collapse-social-small" title="Social" class="collapsed">
                        <i class="fas fa-users padding-small"></i>
                    </a>
                </li>
                <li class="panel anti-panel"><ul id="collapse-social-small" class="collapse ">
                    <li>
                        <a href="https://github.com/jima80525" title="GitHub"><i class="fab fa-github-square padding-small"></i></a>
                    </li>
                    <li>
                        <a href="https://twitter.com/jimande75053775" title="Twitter"><i class="fab fa-twitter-square padding-small"></i></a>
                    </li>
                </ul></li>
                <li class="nav-divider"></li>
                <li>
        <a href="#" title="Back to top" class="collapsed">
            <span class="fas fa-arrow-up"></span>
        </a>
    </li>
            </ul>
        </div>
        <div id="sidebar-wrapper" class="twitchy-background">
            <ul id="accordion" class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="/">
                            <span class="fas fa-home padding-small"></span>
                            Snowboarding Coder
                    </a>
                </li>
                    <li>
                        <a href="/archives.html">
                            <span class="fas fa-th-list padding-small"></span>
                            Recent Articles
                        </a>
                    </li>
                <li class="nav-divider"></li>
                <li id="share">
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse-share" title="Share" class="collapsed">
                        <i class="fas fa-share-alt padding-small"></i>
                        Share
                    </a>
                </li>
                <li class="panel anti-panel"><ul id="collapse-share" class="sidebar_submenu collapse ">
                    <li>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=/using-the-linux-script-command.html" target="popup">
                            <i class="fab fa-facebook-square padding-small"></i>
                            Facebook
                        </a>
                    </li>
                    <li>
                        <a href="https://plus.google.com/share?url=/using-the-linux-script-command.html" target="popup">
                            <i class="fab fa-google-plus-square padding-small"></i>
                            Google+
                        </a>
                    </li>
                    <li>
                        <a href="https://twitter.com/share" class="twitter-share-button" data-count="vertical" target="popup">
                            <i class="fab fa-twitter-square padding-small"></i>
                            Twitter
                        </a>
                    </li>
                </ul></li>
                <li class="nav-divider"></li>
                <li>
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse-social">
                        <i class="fas fa-users padding-small"></i>
                        Contact
                    </a>
                </li>
                <li class="panel anti-panel"><ul id="collapse-social" class="sidebar_submenu collapse ">
                    <li>
                        <a href="https://github.com/jima80525" title="GitHub">
                            <i class="fab fa-github-square padding-small"></i>
                            GitHub
                        </a>
                    </li>
                    <li>
                        <a href="https://twitter.com/jimande75053775" title="Twitter">
                            <i class="fab fa-twitter-square padding-small"></i>
                            Twitter
                        </a>
                    </li>
                </ul></li>
                
                <li class="nav-divider"></li>
                <li>
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse-pages">
                        <i class="fas fa-folder-open padding-small"></i>
                        Pages
                    </a>
                </li>
                <li class="panel anti-panel"><ul id="collapse-pages" class="sidebar_submenu collapse ">
                    <li>
                        <a href="/pages/about.html">
                            <i class="fas fa-file-alt padding-small"></i>
                            About
                        </a>
                    </li>
                </ul></li>
            </ul>
        </div>
        <!-- /#sidebar-wrapper -->
        <!-- open/close sidebar -->
        <a href="#menu-toggle" class="btn btn-primary" id="menu-toggle">
            <span id="right-arrow" class="fas fa-chevron-right"  title="expand sidebar"></span>
            <span id="left-arrow" class="fas fa-chevron-left" title="minimize sidebar"></span>
        </a>
       <!-- /open/close sidebar -->

        <!-- Page Content -->
        <div id="page-content-wrapper">
            <div class="container-fluid">
<section id="content">
    <article>
        <div class="row">
            <div class="col-lg-9">
                <header class="page-header">
                    <h1>
                        <a href="/using-the-linux-script-command.html"
                           rel="bookmark"
                           title="Permalink to Using the Linux 'script' command">
                            Using the Linux 'script' command
                        </a>
                        <small>
<div class="post-info">
    <div class="publish-info-block">
        <small>
            <span class="published">
                <i class="fa fa-calendar padding-small"></i><time datetime="2018-03-04T00:00:00-07:00"> Sun 04 March 2018</time>
            </span>
            <span class="category">
                <i class="fa fa-folder-open padding-small"></i><a href="/category/posts.html">Posts</a>
            </span>
        </small>
    </div>
</div><!-- /.post-info -->                        </small>
                    </h1>
                </header>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-9">
                <div class="entry-content">
                    <p>While working on a different project, I recently discovered the 'script' command in Linux.  It captures all of the input and output from a shell session.  This can be really handy if you want to write a blog post that involves a lot of commands.</p>
<p>I did find that there were a few shortcomings in the tool's interaction that took a bit to work around: my prompt is fairly complicated and causes the script log to look funny, and all of the cool settings I've built over the years to colorize commands really make a mess.</p>
<h2>Fixing the prompt for script</h2>
<p>My bash prompt is set in my .bashrc file. The problem I found is that while I really like my normal prompt, I want to use a trimmed down version of it when I'm capturing scripts.  In order to do this, I've modified the portion of of my .bashrc to set a different prompt if I'm in the script command.  I did not find a way to automatically determine if I was running script or not, so I ended up using an environment variable to determine which prompt to set (more on this later).</p>
<p>The prompt-setting portion of the bashrc now looks something like this:</p>
<div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="n"> -z ${RUN_SCRIPT+x} </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span><span class="w"></span>
<span class="w">   </span><span class="err">#</span><span class="w"> </span><span class="k">general</span><span class="w"> </span><span class="n">purpose</span><span class="w"> </span><span class="n">prompt</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">here</span><span class="w"></span>
<span class="w">   </span><span class="err">#</span><span class="w"> </span><span class="n">Also</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="k">call</span><span class="w"> </span><span class="n">fortune</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">few</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">things</span><span class="w"></span>
<span class="w">   </span><span class="err">#</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">don</span><span class="s1">&#39;t want to run in script</span>
<span class="s1">else</span>
<span class="s1">   PS1=&#39;</span><span class="o">[</span><span class="n">SCRIPT</span><span class="o">]</span><span class="err">\</span><span class="nl">w</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="w"></span>
<span class="n">fi</span><span class="w"></span>
</pre></div>


<p>For those of you unfamiliar with the vagaries of setting prompts in bash, the <code>\w</code> portion get replaced with the current directory.  If you're in the <code>~/coding/project</code> directory, this line will set the main bash prompt to:</p>
<div class="highlight"><pre><span></span><span class="o">[</span><span class="n">SCRIPT</span><span class="o">]~/</span><span class="n">coding</span><span class="o">/</span><span class="nl">project</span><span class="p">:</span><span class="w"></span>
</pre></div>


<h2>Cleaning up the special characters</h2>
<p>Once I got the prompt figured out, I noticed that several commands colorize the output which generates special characters in the captured output.  While your normal terminal knows how to deal with these characters, it looks pretty goofy in the captured output.</p>
<p>Doing a bit of "research" (a.k.a. Google), I found a quick Perl script that will strip those characters out.  As I mentioned above, I want to set an environment varaible before I run script (and unset it when I'm done), so I was already thinking about creating a bash function.  This function is the perfect place to run this cleanup script on the output.  Here's what the function (which lives in my .bashrc) looks like:</p>
<div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">runscript</span> <span class="p">{</span>
   <span class="c1"># set the name of the output file, default &#39;typescript&#39;</span>
   <span class="k">if</span> <span class="p">[</span> <span class="o">-</span><span class="n">z</span> <span class="o">$</span><span class="p">{</span><span class="mi">1</span><span class="o">+</span><span class="n">x</span><span class="p">}</span> <span class="p">];</span> <span class="n">then</span>
      <span class="n">NAME</span><span class="o">=</span><span class="s2">&quot;typescript&quot;</span>
   <span class="k">else</span>
      <span class="n">NAME</span><span class="o">=$</span><span class="mi">1</span>
   <span class="n">fi</span>
   <span class="c1"># set env variable to flag special prompt creation</span>
   <span class="k">export</span> <span class="n">RUN_SCRIPT</span><span class="o">=</span><span class="s1">&#39;foo&#39;</span>

   <span class="c1"># run script and capture the shell output</span>
   <span class="n">script</span> <span class="o">$</span><span class="n">NAME</span>

   <span class="c1"># use regex in Perl, col, and mv to clean up the output</span>
   <span class="n">cat</span> <span class="o">$</span><span class="n">NAME</span> <span class="o">|</span> <span class="n">perl</span> <span class="o">-</span><span class="n">pe</span> <span class="s1">&#39;s/\e([^\[\]]|\[.*?[a-zA-Z]|\].*?</span><span class="se">\a</span><span class="s1">)//g&#39;</span> <span class="o">|</span> <span class="n">col</span> <span class="o">-</span><span class="n">b</span> <span class="o">&gt;</span> <span class="o">$</span><span class="n">NAME</span><span class="o">-</span><span class="n">processed</span>
   <span class="n">mv</span> <span class="o">$</span><span class="n">NAME</span><span class="o">-</span><span class="n">processed</span> <span class="o">$</span><span class="n">NAME</span>

   <span class="c1"># unset env variable to flag special prompt creation</span>
   <span class="n">unset</span> <span class="n">RUN_SCRIPT</span>
<span class="p">}</span>
</pre></div>


<p>Walking through this, we set the <code>$NAME</code> variable to either the default (typescript) or the first command line argument.  Then we export the environment variable we'll use to control the prompt creation and run the <code>script</code> command.</p>
<p>After <code>script</code> returns, we use the magic perl script.  I'm not going to dive into the details of the regex, as it's fairly gnarly and, frankly, not that interesting once it works.  Finally, I move the <code>-processed</code> file back to the original requested filename.</p>
<p>That's it!  With that in my .bashrc, I can now use the <code>runscript &lt;filename&gt;</code> command and it logs all of the output with my custom prompt and without the colorizing characters!</p>
<p>If you'd like more details on the 'script output cleanup' issue, I'd recommend <a href="https://superuser.com/questions/236930/how-to-clean-up-output-of-linux-script-command">this SuperUser post</a>.</p>
<p>If you'd like more info on how to configure your prompt in bash, check <a href="https://www.cyberciti.biz/tips/howto-linux-unix-bash-shell-setup-prompt.html">here</a>.</p>
<p>I hope this was helpful!</p>
                </div>
                <footer class="text-right">
                    <p>- Jim Anderson</p>
                </footer>
            </div>
        </div>
    </article>
</section>
<footer>
    <hr>
    <div class="row">
        <div class="col-lg-9 text-center">
            <p><small>
                Built by <a href="http://docs.getpelican.com/en/latest">Pelican</a> / <a href="https://github.com/ingwinlu/pelican-twitchy">pelican-twitchy</a>
                &middot;                      <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a>
    Content
  licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution 4.0 International License</a>, except where indicated otherwise.

            </small></p>
        </div>
    </div>
</footer>            </div>
        </div>
        <!-- /#page-content-wrapper -->
    </div>
    <!-- /#wrapper -->
    <!-- jQuery Version 1.11.2 -->
    <script src="/theme/js/jquery-1.11.2.min.js"></script>
    <!-- Bootstrap Core JavaScript -->
    <script src="/theme/js/bootstrap.min.js"></script>
    <!-- twitchy Script -->
    <script src="/theme/js/pelican_twitchy.min.js"></script>

</body>
</html>